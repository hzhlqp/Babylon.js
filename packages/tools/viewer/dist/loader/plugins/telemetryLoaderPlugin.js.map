{"version":3,"file":"telemetryLoaderPlugin.js","sourceRoot":"","sources":["../../../src/loader/plugins/telemetryLoaderPlugin.ts"],"names":[],"mappings":"AACA,OAAO,EAAE,gBAAgB,EAAE,MAAM,iCAAiC,CAAC;AAGnE,OAAO,EAAE,aAAa,EAAE,MAAM,yBAAyB,CAAC;AAExD,MAAM,OAAO,qBAAqB;IAMvB,MAAM,CAAC,MAAoD,EAAE,KAAkB;QAClF,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;QACpB,IAAI,CAAC,UAAU,GAAG,aAAa,CAAC,GAAG,CAAC;IACxC,CAAC;IAEM,QAAQ,CAAC,KAAkB;QAC9B,gBAAgB,CAAC,SAAS,CAAC,cAAc,EAAE,KAAK,CAAC,WAAW,EAAE,EAAE;YAC5D,KAAK,EAAE,KAAK;YACZ,QAAQ,EAAE,aAAa,CAAC,GAAG,GAAG,IAAI,CAAC,UAAU;SAChD,CAAC,CAAC;QACH,gBAAgB,CAAC,gBAAgB,CAAC,KAAK,CAAC,QAAQ,CAAC,SAAS,EAAE,EAAE,KAAK,CAAC,WAAW,EAAE,CAAC,CAAC;IACvF,CAAC;IAEM,OAAO;QACV,IAAI,CAAC,QAAQ,GAAG,aAAa,CAAC,GAAG,CAAC;QAClC,gBAAgB,CAAC,SAAS,CAAC,YAAY,EAAE,IAAI,CAAC,MAAM,CAAC,WAAW,EAAE,EAAE;YAChE,KAAK,EAAE,IAAI,CAAC,MAAM;YAClB,QAAQ,EAAE,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,UAAU;SAC5C,CAAC,CAAC;QAEH,gBAAgB,CAAC,gBAAgB,CAAC,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,SAAS,EAAE,EAAE,IAAI,CAAC,MAAM,CAAC,WAAW,EAAE,CAAC,CAAC;IACnG,CAAC;IAEM,UAAU;QACb,IAAI,CAAC,QAAQ,GAAG,aAAa,CAAC,GAAG,CAAC;QAClC,gBAAgB,CAAC,SAAS,CAAC,eAAe,EAAE,IAAI,CAAC,MAAM,CAAC,WAAW,EAAE,EAAE;YACnE,KAAK,EAAE,IAAI,CAAC,MAAM;YAClB,QAAQ,EAAE,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,UAAU;SAC5C,CAAC,CAAC;QAEH,gBAAgB,CAAC,gBAAgB,CAAC,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,SAAS,EAAE,EAAE,IAAI,CAAC,MAAM,CAAC,WAAW,EAAE,CAAC,CAAC;IACnG,CAAC;CACJ","sourcesContent":["import type { ILoaderPlugin } from \"./loaderPlugin\";\r\nimport { telemetryManager } from \"../../managers/telemetryManager\";\r\nimport type { ViewerModel } from \"../../model/viewerModel\";\r\nimport type { ISceneLoaderPlugin, ISceneLoaderPluginAsync } from \"core/Loading/sceneLoader\";\r\nimport { PrecisionDate } from \"core/Misc/precisionDate\";\r\n\r\nexport class TelemetryLoaderPlugin implements ILoaderPlugin {\r\n    private _model: ViewerModel;\r\n\r\n    private _loadStart: number;\r\n    private _loadEnd: number;\r\n\r\n    public onInit(loader: ISceneLoaderPlugin | ISceneLoaderPluginAsync, model: ViewerModel) {\r\n        this._model = model;\r\n        this._loadStart = PrecisionDate.Now;\r\n    }\r\n\r\n    public onLoaded(model: ViewerModel) {\r\n        telemetryManager.broadcast(\"Model Loaded\", model.getViewerId(), {\r\n            model: model,\r\n            loadTime: PrecisionDate.Now - this._loadStart,\r\n        });\r\n        telemetryManager.flushWebGLErrors(model.rootMesh.getEngine(), model.getViewerId());\r\n    }\r\n\r\n    public onError() {\r\n        this._loadEnd = PrecisionDate.Now;\r\n        telemetryManager.broadcast(\"Load Error\", this._model.getViewerId(), {\r\n            model: this._model,\r\n            loadTime: this._loadEnd - this._loadStart,\r\n        });\r\n\r\n        telemetryManager.flushWebGLErrors(this._model.rootMesh.getEngine(), this._model.getViewerId());\r\n    }\r\n\r\n    public onComplete() {\r\n        this._loadEnd = PrecisionDate.Now;\r\n        telemetryManager.broadcast(\"Load Complete\", this._model.getViewerId(), {\r\n            model: this._model,\r\n            loadTime: this._loadEnd - this._loadStart,\r\n        });\r\n\r\n        telemetryManager.flushWebGLErrors(this._model.rootMesh.getEngine(), this._model.getViewerId());\r\n    }\r\n}\r\n"]}