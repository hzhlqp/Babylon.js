{"version":3,"file":"utils.js","sourceRoot":"","sources":["../src/utils.ts"],"names":[],"mappings":"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","sourcesContent":["/* eslint-disable no-console */\r\nimport type { Page } from \"puppeteer\";\r\nimport type { StacktracedObject } from \"./window\";\r\n\r\ndeclare const BABYLON: typeof window.BABYLON;\r\n\r\nconst classesToCheck = [\"BABYLON.Camera\", \"BABYLON.TransformNode\", \"BABYLON.Scene\", \"BABYLON.Vector3\", \"BABYLON.BaseTexture\", \"BABYLON.Material\"];\r\n\r\nexport interface CountValues {\r\n    numberOfObjects: number;\r\n    usedJSHeapSize: number;\r\n    specifics: {\r\n        [type: string]: string[];\r\n    };\r\n    eventsRegistered: typeof window.eventsRegistered;\r\n}\r\n\r\nexport const countCurrentObjects = async (initialValues: CountValues, classes = classesToCheck, checkGlobalObjects?: boolean, flip?: boolean) => {\r\n    const current = await countObjects(page, classes);\r\n    // check that all events are cleared and all objects are gone:\r\n    Object.keys(current.eventsRegistered).forEach((eventName) => {\r\n        const stacks = current.eventsRegistered[eventName].stackTraces;\r\n        const numberOfActiveListeners = current.eventsRegistered[eventName].numberAdded - current.eventsRegistered[eventName].numberRemoved;\r\n        if (flip) {\r\n            expect(numberOfActiveListeners, `event ${eventName} is not removed ${numberOfActiveListeners} time(s). ${(stacks || []).join(\"\\n\")}`).toBeGreaterThanOrEqual(0);\r\n        } else {\r\n            expect(numberOfActiveListeners, `event ${eventName} is not removed ${numberOfActiveListeners} time(s). ${(stacks || []).join(\"\\n\")}`).toBeLessThanOrEqual(0);\r\n        }\r\n    });\r\n\r\n    Object.keys(current.specifics).forEach((type) => {\r\n        const delta = current.specifics[type].length - initialValues.specifics[type].length;\r\n\r\n        // cross before and after\r\n        current.specifics[type]\r\n            .filter((id) => initialValues.specifics[type].indexOf(id) === -1)\r\n            .forEach((id) => {\r\n                expect(id, `Type ${type} (${current.stackTraces[id]?.className}) is not disposed; StackTrace: ${current.stackTraces[id]?.stackTrace}`).toBe(null);\r\n            });\r\n        if (flip) {\r\n            expect(delta, `type ${type} is not disposed ${delta} times`).toBeGreaterThanOrEqual(0);\r\n        } else {\r\n            expect(delta, `type ${type} is not disposed ${delta} times`).toBeLessThanOrEqual(0);\r\n        }\r\n    });\r\n\r\n    // this test is too specific and requires thorough testing\r\n    if (checkGlobalObjects) {\r\n        if (flip) {\r\n            expect(current.numberOfObjects, `number of objects is not disposed ${current.numberOfObjects - initialValues.numberOfObjects} times`).toBeGreaterThanOrEqual(\r\n                initialValues.numberOfObjects\r\n            );\r\n        } else {\r\n            expect(current.numberOfObjects, `number of objects is not disposed ${current.numberOfObjects - initialValues.numberOfObjects} times`).toBeLessThanOrEqual(\r\n                initialValues.numberOfObjects\r\n            );\r\n        }\r\n    }\r\n};\r\n\r\nexport const evaluateInitEngine = async (engineName: string, baseUrl: string, parallelCompilation: boolean = true) => {\r\n    // run garbage collection\r\n    window.gc && window.gc();\r\n    engineName = engineName ? engineName.toLowerCase() : \"webgl2\";\r\n\r\n    BABYLON.Tools.ScriptBaseUrl = baseUrl;\r\n\r\n    const canvas = document.getElementById(\"babylon-canvas\") as HTMLCanvasElement;\r\n    if (!canvas) return;\r\n    window.canvas = canvas;\r\n    if (engineName === \"webgpu\") {\r\n        const options = {\r\n            antialias: false,\r\n        };\r\n\r\n        const engine = new BABYLON.WebGPUEngine(canvas, options);\r\n        engine.enableOfflineSupport = false;\r\n        window.engine = engine;\r\n        await engine.initAsync();\r\n    } else {\r\n        const engine = new BABYLON.Engine(canvas, true, {\r\n            disableWebGL2Support: engineName === \"webgl1\" ? true : false,\r\n        });\r\n        engine.enableOfflineSupport = false;\r\n        window.engine = engine;\r\n    }\r\n    window.engine!.renderEvenInBackground = true;\r\n    window.engine.getCaps().parallelShaderCompile = undefined;\r\n    return !!window.engine;\r\n};\r\n\r\nexport const evaluateEventListenerAugmentation = async () => {\r\n    const realAddEventListener = EventTarget.prototype.addEventListener;\r\n    const realRemoveEventListener = EventTarget.prototype.removeEventListener;\r\n\r\n    window.eventsRegistered = {};\r\n\r\n    EventTarget.prototype.addEventListener = function (a, b, c) {\r\n        realAddEventListener(a, b, c);\r\n        window.eventsRegistered[a] = window.eventsRegistered[a] || {\r\n            numberAdded: 0,\r\n            numberRemoved: 0,\r\n            registeredFunctions: [],\r\n        };\r\n        window.eventsRegistered[a].numberAdded++;\r\n        // find if this function was registered already\r\n        const registered = window.eventsRegistered[a].registeredFunctions.findIndex((f) => f && f.eventListener === b);\r\n        if (registered === -1) {\r\n            window.eventsRegistered[a].registeredFunctions.push({\r\n                eventListener: b,\r\n                timesAdded: 1,\r\n            });\r\n        } else {\r\n            window.eventsRegistered[a].registeredFunctions[registered]!.timesAdded++;\r\n        }\r\n        try {\r\n            throw new Error();\r\n        } catch (err) {\r\n            if (window.sourceMappedStackTrace) {\r\n                window.sourcemapPromises = window.sourcemapPromises || [];\r\n                const promise = new Promise<null>((resolve) => {\r\n                    try {\r\n                        window.sourceMappedStackTrace.mapStackTrace(\r\n                            err.stack,\r\n                            (stackArray) => {\r\n                                window.eventsRegistered[a].stackTraces = window.eventsRegistered[a].stackTraces || [];\r\n                                window.eventsRegistered[a].stackTraces!.push(stackArray.join(\"\\n\").replace(/^Error\\n/, \"Stacktrace\\n\") + \"\\n>>\\n\");\r\n                                resolve(null);\r\n                            },\r\n                            {\r\n                                sync: true,\r\n                                cacheGlobally: true,\r\n                                filter: (line: string) => {\r\n                                    return line.indexOf(\"puppeteer\") === -1;\r\n                                },\r\n                            }\r\n                        );\r\n                    } catch (err) {\r\n                        window.eventsRegistered[a].stackTraces = window.eventsRegistered[a].stackTraces || [];\r\n                        window.eventsRegistered[a].stackTraces!.push(err.stack.replace(/^Error\\n/, \"Stacktrace\\n\") + \"\\n>>\\n\");\r\n                        resolve(null);\r\n                    }\r\n                });\r\n                window.sourcemapPromises.push(promise);\r\n            } else {\r\n                window.eventsRegistered[a].stackTraces = window.eventsRegistered[a].stackTraces || [];\r\n                window.eventsRegistered[a].stackTraces!.push(err.stack.replace(/^Error\\n/, \"Stacktrace\\n\") + \"\\n>>\\n\");\r\n            }\r\n        }\r\n    };\r\n\r\n    EventTarget.prototype.removeEventListener = function (a, b, c) {\r\n        realRemoveEventListener(a, b, c);\r\n        window.eventsRegistered[a] = window.eventsRegistered[a] || {\r\n            numberAdded: 0,\r\n            numberRemoved: 0,\r\n            registeredFunctions: [],\r\n        };\r\n        // find the registered\r\n        const registered = window.eventsRegistered[a].registeredFunctions.findIndex((f) => f && f.eventListener === b);\r\n        if (registered !== -1) {\r\n            window.eventsRegistered[a].numberRemoved += window.eventsRegistered[a].registeredFunctions[registered]!.timesAdded;\r\n            window.eventsRegistered[a].registeredFunctions[registered] = null;\r\n        } else {\r\n            // console.error(\"could not find registered function\");\r\n        }\r\n    };\r\n};\r\n\r\nexport const evaluateCreateScene = async () => {\r\n    if (window.engine && !window.scene) {\r\n        window.scene = new BABYLON.Scene(window.engine);\r\n    }\r\n\r\n    return !!window.scene;\r\n};\r\n\r\nexport const evaluateRenderScene = async (renderCount = 1) => {\r\n    if (window.scene && window.engine) {\r\n        const now = performance.now();\r\n        for (let i = 0; i < renderCount; i++) {\r\n            window.scene.render();\r\n        }\r\n        return performance.now() - now;\r\n    } else {\r\n        throw new Error(\"no scene found\");\r\n    }\r\n};\r\n\r\nexport const evaluateDisposeScene = async () => {\r\n    if (window.scene) {\r\n        window.scene.dispose();\r\n        window.scene = null;\r\n        window.gc && window.gc();\r\n    }\r\n};\r\n\r\nexport const evaluateDisposeEngine = async () => {\r\n    if (window.engine) {\r\n        window.engine.dispose();\r\n        window.engine = null;\r\n        window.gc && window.gc();\r\n    }\r\n};\r\n\r\nexport const evaluateDefaultScene = async () => {\r\n    if (!window.scene) {\r\n        window.scene = new BABYLON.Scene(window.engine!);\r\n    }\r\n    // This creates and positions a free camera (non-mesh)\r\n    const camera = new BABYLON.FreeCamera(\"camera1\", new BABYLON.Vector3(0, 5, -10), window.scene);\r\n\r\n    // This targets the camera to scene origin\r\n    camera.setTarget(BABYLON.Vector3.Zero());\r\n\r\n    // This attaches the camera to the canvas\r\n    camera.attachControl(true);\r\n\r\n    // This creates a light, aiming 0,1,0 - to the sky (non-mesh)\r\n    const light = new BABYLON.HemisphericLight(\"light\", new BABYLON.Vector3(0, 1, 0), window.scene);\r\n\r\n    // Default intensity is 1. Let's dim the light a small amount\r\n    light.intensity = 0.7;\r\n\r\n    // Our built-in 'sphere' shape.\r\n    const sphere = BABYLON.MeshBuilder.CreateSphere(\"sphere\", { diameter: 2, segments: 32 }, window.scene);\r\n\r\n    // Move the sphere upward 1/2 its height\r\n    sphere.position.y = 1;\r\n\r\n    // Our built-in 'ground' shape.\r\n    BABYLON.MeshBuilder.CreateGround(\"ground\", { width: 6, height: 6 }, window.scene);\r\n};\r\n\r\nexport const prepareLeakDetection = async (classes: string[] = classesToCheck) => {\r\n    window.classesConstructed = window.classesConstructed || {};\r\n    const setStackStrace = (target: any) => {\r\n        const id = Math.random().toString(36).substring(2, 15);\r\n        target.__id = id;\r\n        try {\r\n            throw new Error();\r\n        } catch (err) {\r\n            if (window.sourceMappedStackTrace) {\r\n                window.sourcemapPromises = window.sourcemapPromises || [];\r\n                const promise = new Promise<StacktracedObject>((resolve) => {\r\n                    try {\r\n                        window.sourceMappedStackTrace.mapStackTrace(\r\n                            err.stack,\r\n                            (stackArray) => {\r\n                                const stackTrace = \"\\n\" + stackArray.slice(4, stackArray.length - 1).join(\"\\n\");\r\n                                target.__stackStrace = stackTrace;\r\n                                window.classesConstructed[id] = { id: id, stackTrace: stackTrace, className: target.getClassName ? target.getClassName() : \"unknown\" };\r\n                                resolve(window.classesConstructed[id]);\r\n                            },\r\n                            { cacheGlobally: true, sync: true }\r\n                        );\r\n                    } catch (e) {\r\n                        target.__stackStrace = err.stack;\r\n                        window.classesConstructed[id] = { id: id, stackTrace: err.stack, className: target.getClassName ? target.getClassName() : \"unknown\" };\r\n                        resolve(window.classesConstructed[id]);\r\n                    }\r\n                });\r\n                window.sourcemapPromises.push(promise);\r\n            } else {\r\n                const stackArray = err.stack.split(\"\\n\");\r\n                const stackTrace = \"\\n\" + stackArray.slice(4, stackArray.length - 1).join(\"\\n\");\r\n                target.__stackStrace = stackTrace;\r\n                window.classesConstructed[id] = { id: id, stackTrace: stackTrace, className: target.getClassName ? target.getClassName() : \"unknown\" };\r\n            }\r\n        }\r\n    };\r\n    // any to allow compilation without building core\r\n    window.engine?.onNewSceneAddedObservable.add((scene: any) => {\r\n        setStackStrace(scene);\r\n        [\r\n            \"onNewCameraAddedObservable\",\r\n            \"onNewLightAddedObservable\",\r\n            \"onNewTransformNodeAddedObservable\",\r\n            \"onNewMeshAddedObservable\",\r\n            \"onNewSkeletonAddedObservable\",\r\n            \"onNewMaterialAddedObservable\",\r\n            \"onNewTextureAddedObservable\",\r\n        ].forEach((observable: string) => {\r\n            (scene as any)[observable].add((target: any) => {\r\n                setStackStrace(target);\r\n            });\r\n        });\r\n    });\r\n    classes.forEach((classToCheck: string) => {\r\n        const references = classToCheck.split(\".\");\r\n        const objectName: string = references.pop()!;\r\n        const parentObject: any = references.reduce((o, i: string) => o[i], window as any);\r\n        // const originalConstructor = parentObject[objectName];\r\n        const originalPrototype = parentObject[objectName].prototype;\r\n        const originalDispose = originalPrototype.dispose;\r\n        originalPrototype.dispose = function () {\r\n            // eslint-disable-next-line prefer-rest-params\r\n            originalDispose.apply(this, arguments);\r\n            this.__disposeCalled = true;\r\n        };\r\n    });\r\n};\r\n\r\nexport const countObjects = async (page: Page, classes = classesToCheck) => {\r\n    await page.waitForNetworkIdle({\r\n        idleTime: 300,\r\n        timeout: 0,\r\n    });\r\n    await page.evaluate(() => window.gc && window.gc());\r\n\r\n    const prototypeHandle = await page.evaluateHandle(() => Object.prototype);\r\n    const objectsHandle = await page.queryObjects(prototypeHandle);\r\n    const numberOfObjects = await page.evaluate((instances) => instances.length, objectsHandle);\r\n    const usedJSHeapSize = await page.evaluate(() => {\r\n        return ((window.performance as any).memory && (window.performance as any).memory.usedJSHeapSize) || 0;\r\n    });\r\n    await Promise.all([prototypeHandle.dispose(), objectsHandle.dispose()]);\r\n    const specifics: { [type: string]: string[] } = {};\r\n    await page.evaluate(async () => {\r\n        if (window.sourcemapPromises) {\r\n            await Promise.all(window.sourcemapPromises);\r\n        }\r\n    });\r\n    for (const classToCheck of classes) {\r\n        const prototype = classToCheck + \".prototype\";\r\n        // tslint:disable-next-line: no-eval\r\n        const prototypeHandle = await page.evaluateHandle((p) => eval(p), prototype);\r\n        const objectsHandle = await page.queryObjects(prototypeHandle);\r\n        const array = await page.evaluate(\r\n            (objects) =>\r\n                objects.map((object: any) => {\r\n                    if (!object.__id) {\r\n                        object.__id = Math.random().toString(36).substring(2, 15);\r\n                    }\r\n                    return object.__id;\r\n                }),\r\n            objectsHandle\r\n        );\r\n        // const count = await page.evaluate((objects) => objects.length, objectsHandle);\r\n        await prototypeHandle.dispose();\r\n        await objectsHandle.dispose();\r\n        specifics[classToCheck] = array;\r\n    }\r\n    const eventsRegistered = await page.evaluate(() => window.eventsRegistered);\r\n    const stackTraces = await page.evaluate(() => window.classesConstructed);\r\n\r\n    // TODO - check if we can use performance.memory.usedJSHeapSize\r\n\r\n    return { numberOfObjects, usedJSHeapSize, specifics, eventsRegistered, stackTraces };\r\n};\r\n\r\nexport type PerformanceTestType = \"dev\" | \"preview\" | \"stable\";\r\n\r\nexport const checkPerformanceOfScene = async (\r\n    page: Page,\r\n    baseUrl: string,\r\n    type: PerformanceTestType,\r\n    createSceneFunction: (metadata?: { playgroundId?: string }, config?: any) => Promise<void>,\r\n    numberOfPasses: number = 5,\r\n    framesToRender: number = 10000,\r\n    metadata?: { playgroundId: string },\r\n    config?: any\r\n) => {\r\n    if (numberOfPasses < 5) {\r\n        numberOfPasses = 5;\r\n    }\r\n    const url = type === \"dev\" ? \"/empty.html\" : `/empty-${type}.html`;\r\n    await page.goto(baseUrl + url, {\r\n        // waitUntil: \"load\", // for chrome should be \"networkidle0\"\r\n        timeout: 0,\r\n    });\r\n    await page.waitForSelector(\"#babylon-canvas\", { timeout: 20000 });\r\n\r\n    const time = [];\r\n    for (let i = 0; i < numberOfPasses; i++) {\r\n        await page.evaluate(evaluateInitEngine, \"webgl2\", baseUrl);\r\n        await page.evaluate(createSceneFunction, metadata || {}, config || {});\r\n        time.push(await page.evaluate(evaluateRenderScene, framesToRender));\r\n        await page.evaluate(evaluateDisposeScene);\r\n        await page.evaluate(evaluateDisposeEngine);\r\n    }\r\n    time.sort();\r\n    // remove edge cases - 2 of each end\r\n    time.pop();\r\n    time.pop();\r\n    time.shift();\r\n    time.shift();\r\n    // return the average rendering time\r\n    return time.reduce((partialSum, a) => partialSum + a, 0) / (numberOfPasses - 2);\r\n};\r\n\r\nexport const logPageErrors = async (page: Page, debug?: boolean) => {\r\n    page.on(\"console\", async (msg) => {\r\n        // serialize my args the way I want\r\n        const args: any[] = await Promise.all(\r\n            msg.args().map((arg: any) =>\r\n                arg.evaluate((argument: string | Error) => {\r\n                    // I'm in a page context now. If my arg is an error - get me its message.\r\n                    if (argument instanceof Error) return `[ERR] ${argument.message}`;\r\n                    //Return the argument if it is just a message\r\n                    return `[STR] ${argument}`;\r\n                }, arg)\r\n            )\r\n        );\r\n        args.filter((arg) => arg !== null).forEach((arg) => console.log(arg));\r\n        // fallback\r\n        if (!debug) {\r\n            if (args.filter((arg) => arg !== null).length === 0 && msg.type().substring(0, 3).toUpperCase() === \"ERR\") {\r\n                console.log(`${msg.type().substring(0, 3).toUpperCase()} ${msg.text()}`);\r\n            }\r\n        } else {\r\n            console.log(`${msg.type().substring(0, 3).toUpperCase()} ${msg.text()}`);\r\n        }\r\n    });\r\n    page.on(\"pageerror\", ({ message }) => console.log(message)).on(\"requestfailed\", (request) => console.log(`${request.failure()?.errorText} ${request.url()}`));\r\n};\r\n"]}