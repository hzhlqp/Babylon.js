{"version":3,"file":"webpackTools.js","sourceRoot":"","sources":["../src/webpackTools.ts"],"names":[],"mappings":"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","sourcesContent":["/* eslint-disable no-console */\r\nimport type ts from \"typescript\";\r\nimport transformer from \"./pathTransform.js\";\r\nimport type { BuildType, DevPackageName, UMDPackageName } from \"./packageMapping.js\";\r\nimport { getPackageMappingByDevName, getPublicPackageName, isValidDevPackageName, umdPackageMapping } from \"./packageMapping.js\";\r\nimport * as path from \"path\";\r\nimport { camelize } from \"./utils.js\";\r\nimport type { RuleSetRule, Configuration } from \"webpack\";\r\n\r\nexport const externalsFunction = (excludePackages: string[] = [], type: BuildType = \"umd\") => {\r\n    return function ({ context, request }: { context: string; request: string }, callback: (err: Error | null, result?: any) => void) {\r\n        if (request.includes(\"babylonjs-gltf2interface\")) {\r\n            return callback(null, {\r\n                root: [\"BABYLON\", \"GLTF2\"],\r\n                commonjs: \"babylonjs-gltf2interface\",\r\n                commonjs2: \"babylonjs-gltf2interface\",\r\n                amd: \"babylonjs-gltf2interface\",\r\n            });\r\n        }\r\n        // fix for mac\r\n        if (request.includes(\"webpack\")) {\r\n            return callback(null);\r\n        }\r\n        const importParts = request.split(\"/\");\r\n        const devPackageName = importParts[0].replace(/^babylonjs/, \"\") || \"core\";\r\n        // check if this request needs to be ignored or transformed\r\n        if (excludePackages.indexOf(devPackageName) === -1 && isValidDevPackageName(devPackageName, true)) {\r\n            const packages = getPackageMappingByDevName(devPackageName, true);\r\n            const buildTypePackage = getPublicPackageName(packages[type], request);\r\n            const namespaceName = getPublicPackageName(packages.namespace, request);\r\n            // check if the \"external\"  is actually a local dependency\r\n            const umdPackageName = getPublicPackageName(packages[\"umd\"], request) as UMDPackageName;\r\n            const directoryToExpect = umdPackageMapping[umdPackageName].baseDir || \"core\";\r\n            if (directoryToExpect && context.replace(/\\\\/g, \"/\").includes(\"/\" + directoryToExpect + \"/\")) {\r\n                return callback(null);\r\n            }\r\n            if (request.indexOf(\"ktx2decoderTypes\") !== -1) {\r\n                return callback(null);\r\n            }\r\n            if (type === \"umd\" || type === \"es6\") {\r\n                return callback(null, {\r\n                    root: namespaceName.indexOf(\".\") !== -1 ? namespaceName.split(\".\") : namespaceName,\r\n                    commonjs: buildTypePackage,\r\n                    commonjs2: buildTypePackage,\r\n                    amd: buildTypePackage,\r\n                });\r\n            }\r\n        }\r\n        return callback(null); // was ()\r\n    };\r\n};\r\n\r\nexport const getRules = (\r\n    options: {\r\n        includeAssets?: boolean;\r\n        includeCSS?: boolean;\r\n        sideEffects?: boolean;\r\n        tsOptions?: {\r\n            configFile?: string;\r\n            getCustomTransformers?: (_program: ts.Program) => Required<Pick<ts.CustomTransformers, \"after\" | \"afterDeclarations\">>;\r\n            [key: string]: any;\r\n        };\r\n        resourceType?: \"asset/inline\" | \"asset/resource\";\r\n        extraRules?: RuleSetRule[];\r\n        mode?: \"development\" | \"production\";\r\n    } = {\r\n        includeAssets: true,\r\n        includeCSS: true,\r\n        sideEffects: true,\r\n    }\r\n) => {\r\n    const rules: RuleSetRule[] = [\r\n        {\r\n            test: /\\.tsx?$/,\r\n            loader: \"ts-loader\",\r\n            exclude: /node_modules/,\r\n            sideEffects: options.sideEffects,\r\n            options: {\r\n                configFile: \"tsconfig.build.json\",\r\n                ...options.tsOptions,\r\n            },\r\n        },\r\n        {\r\n            sideEffects: options.sideEffects,\r\n            test: /\\.js$/,\r\n            enforce: \"pre\",\r\n            use: [\"source-map-loader\"],\r\n        },\r\n    ];\r\n    if (options.includeAssets) {\r\n        rules.push({\r\n            test: /\\.(png|svg|jpg|jpeg|gif|ttf)$/i,\r\n            type: options.resourceType || \"asset/inline\",\r\n        });\r\n    }\r\n    if (options.includeCSS) {\r\n        rules.push(\r\n            {\r\n                sideEffects: options.sideEffects,\r\n                test: /(?<!modules)\\.s[ac]ss$/i,\r\n                use: [\r\n                    \"style-loader\",\r\n                    {\r\n                        loader: \"css-loader\",\r\n                        options: {\r\n                            sourceMap: true,\r\n                            modules: \"global\",\r\n                        },\r\n                    },\r\n                    {\r\n                        loader: \"sass-loader\",\r\n                        options: {\r\n                            sourceMap: true,\r\n                        },\r\n                    },\r\n                ],\r\n            },\r\n            {\r\n                sideEffects: options.sideEffects,\r\n                test: /\\.modules\\.s[ac]ss$/i,\r\n                use: [\r\n                    \"style-loader\",\r\n                    {\r\n                        loader: \"css-loader\",\r\n                        options: {\r\n                            sourceMap: true,\r\n                            modules: {\r\n                                localIdentName: options.mode === \"production\" ? \"[hash:base64]\" : \"[path][name]__[local]\",\r\n                            },\r\n                        },\r\n                    },\r\n                    {\r\n                        loader: \"sass-loader\",\r\n                        options: {\r\n                            sourceMap: true,\r\n                        },\r\n                    },\r\n                ],\r\n            },\r\n            {\r\n                test: /\\.css$/,\r\n                use: [\r\n                    \"style-loader\",\r\n                    {\r\n                        loader: \"css-loader\",\r\n                        options: {\r\n                            sourceMap: true,\r\n                        },\r\n                    },\r\n                ],\r\n            }\r\n        );\r\n    }\r\n    rules.push(...(options.extraRules || []));\r\n    return rules;\r\n};\r\n\r\nexport const commonDevWebpackConfiguration = (\r\n    env: {\r\n        mode: \"development\" | \"production\";\r\n        outputFilename: string;\r\n        dirName: string;\r\n        dirSuffix?: string;\r\n        enableHttps?: boolean;\r\n        enableHotReload?: boolean;\r\n        enableLiveReload?: boolean;\r\n    },\r\n    devServerConfig?: {\r\n        port: number;\r\n        static?: string[];\r\n        showBuildProgress?: boolean;\r\n    }\r\n) => {\r\n    const production = env.mode === \"production\" || process.env.NODE_ENV === \"production\";\r\n    return {\r\n        mode: production ? \"production\" : \"development\",\r\n        devtool: production ? \"source-map\" : \"inline-cheap-module-source-map\",\r\n        devServer: devServerConfig\r\n            ? {\r\n                  port: devServerConfig.port,\r\n                  static: devServerConfig.static ? devServerConfig.static.map((dir) => path.resolve(dir)) : undefined,\r\n                  webSocketServer: production ? false : \"ws\",\r\n                  compress: production,\r\n                  server: env.enableHttps !== undefined || process.env.ENABLE_HTTPS === \"true\" ? \"https\" : \"http\",\r\n                  hot: (env.enableHotReload !== undefined || process.env.ENABLE_HOT_RELOAD === \"true\") && !production ? true : false,\r\n                  liveReload: (env.enableLiveReload !== undefined || process.env.ENABLE_LIVE_RELOAD === \"true\") && !production ? true : false,\r\n                  headers: {\r\n                      // eslint-disable-next-line @typescript-eslint/naming-convention\r\n                      \"Access-Control-Allow-Origin\": \"*\",\r\n                  },\r\n                  client: {\r\n                      overlay: process.env.DISABLE_DEV_OVERLAY\r\n                          ? false\r\n                          : {\r\n                                warnings: false,\r\n                                errors: true,\r\n                            },\r\n                      logging: production ? \"error\" : \"info\",\r\n                      progress: devServerConfig.showBuildProgress,\r\n                  },\r\n                  allowedHosts: process.env.ALLOWED_HOSTS ? process.env.ALLOWED_HOSTS.split(\",\") : undefined,\r\n              }\r\n            : undefined,\r\n        output: env.outputFilename\r\n            ? {\r\n                  path: path.resolve(env.dirName, \"dist\", env.dirSuffix || \"\"),\r\n                  filename: env.outputFilename,\r\n                  clean: true,\r\n                  devtoolModuleFilenameTemplate: production ? \"webpack://[namespace]/[resource-path]?[loaders]\" : \"file:///[absolute-resource-path]\",\r\n              }\r\n            : undefined,\r\n    };\r\n};\r\n\r\nexport const commonUMDWebpackConfiguration = (options: {\r\n    entryPoints?: { [name: string]: string };\r\n    overrideFilename?: string | ((chunk: any) => string);\r\n    devPackageName: DevPackageName;\r\n    devPackageAliasPath?: string;\r\n    mode?: \"development\" | \"production\";\r\n    namespace?: string;\r\n    outputPath?: string;\r\n    alias?: { [key: string]: string };\r\n    optionalExternalFunctionSkip?: string[];\r\n    extendedWebpackConfig?: Partial<Configuration>;\r\n    es6Mode?: boolean;\r\n    maxMode?: boolean; // if true filename will have .max for the dev version and nothing for the prod version\r\n    extraExternals?: Configuration[\"externals\"]; // see https://webpack.js.org/configuration/externals/#combining-syntaxes\r\n}) => {\r\n    const packageMapping = getPackageMappingByDevName(options.devPackageName);\r\n    const packageName = getPublicPackageName(options.es6Mode ? packageMapping.es6 : packageMapping.umd);\r\n    const umdPackageName = getPublicPackageName(packageMapping.umd);\r\n    const filename = `${\r\n        options.overrideFilename && typeof options.overrideFilename === \"string\" ? options.overrideFilename : umdPackageMapping[umdPackageName as UMDPackageName].baseFilename\r\n    }${umdPackageMapping[umdPackageName as UMDPackageName].isBundle ? \".bundle\" : \"\"}${\r\n        options.maxMode ? (options.mode && options.mode === \"development\" ? \".max\" : \"\") : options.mode && options.mode === \"production\" ? \".min\" : \"\"\r\n    }.js`;\r\n    return {\r\n        entry: options.entryPoints ?? \"./src/index.ts\",\r\n        devtool: options.mode === \"production\" ? \"source-map\" : \"inline-cheap-module-source-map\",\r\n        mode: options.mode || \"development\",\r\n        output: {\r\n            path: options.outputPath || path.resolve(\"./dist\"),\r\n            filename: (typeof options.overrideFilename === \"function\" && options.overrideFilename) || filename,\r\n            library: {\r\n                name: {\r\n                    root: (options.namespace && options.namespace.split(\".\")) || [options.devPackageName.toUpperCase()],\r\n                    amd: packageName,\r\n                    commonjs: packageName,\r\n                },\r\n                type: \"umd\",\r\n            },\r\n            libraryExport: \"default\",\r\n            umdNamedDefine: true,\r\n            globalObject: '(typeof self !== \"undefined\" ? self : typeof global !== \"undefined\" ? global : this)',\r\n        },\r\n        resolve: {\r\n            extensions: [\".ts\", \".js\"],\r\n            alias: {\r\n                // default alias - for its own package to the lts version\r\n                [options.devPackageName]: path.resolve(options.devPackageAliasPath || `../../../lts/${camelize(options.devPackageName)}/dist`),\r\n                ...options.alias,\r\n            },\r\n        },\r\n        externals: [options.extraExternals || {}, externalsFunction([options.devPackageName, ...(options.optionalExternalFunctionSkip || [])], options.es6Mode ? \"es6\" : \"umd\")],\r\n        module: {\r\n            rules: getRules({\r\n                tsOptions: {\r\n                    getCustomTransformers: (_program: ts.Program) => {\r\n                        // webpack program\r\n                        console.log(\"generating transformers...\");\r\n                        return {\r\n                            after: [\r\n                                transformer(_program, {\r\n                                    basePackage: packageName,\r\n                                    buildType: options.es6Mode ? \"es6\" : \"umd\",\r\n                                    packageOnly: false,\r\n                                    keepDev: true,\r\n                                }),\r\n                            ],\r\n                            afterDeclarations: [\r\n                                transformer(_program, {\r\n                                    basePackage: packageName,\r\n                                    buildType: options.es6Mode ? \"es6\" : \"umd\",\r\n                                    packageOnly: false,\r\n                                    keepDev: true,\r\n                                }),\r\n                            ],\r\n                        };\r\n                    },\r\n                },\r\n                sideEffects: true,\r\n                includeAssets: true,\r\n                includeCSS: true,\r\n                mode: options.mode || \"development\",\r\n            }),\r\n        },\r\n        ...options.extendedWebpackConfig,\r\n    } as Configuration;\r\n};\r\n"]}