{"version":3,"file":"topBarComponent.js","sourceRoot":"","sources":["../../../../../../../src/components/actionTabs/tabs/propertyGrids/animations/curveEditor/topBarComponent.tsx"],"names":[],"mappings":"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","sourcesContent":["import type { Observer } from \"core/Misc/observable\";\r\nimport type { Nullable } from \"core/types\";\r\nimport * as React from \"react\";\r\nimport type { GlobalState } from \"../../../../../globalState\";\r\nimport type { Context, IActiveAnimationChangedOptions } from \"./context\";\r\nimport { ActionButtonComponent } from \"./controls/actionButtonComponent\";\r\nimport { TextInputComponent } from \"./controls/textInputComponent\";\r\n\r\nimport \"./scss/topBar.scss\";\r\n\r\nimport logoIcon from \"./assets/babylonLogo.svg\";\r\nimport frameIcon from \"./assets/frameIcon.svg\";\r\nimport newKeyIcon from \"./assets/newKeyIcon.svg\";\r\nimport flatTangentIcon from \"./assets/flatTangentIcon.svg\";\r\nimport linearTangentIcon from \"./assets/linearTangentIcon.svg\";\r\nimport breakTangentIcon from \"./assets/breakTangentIcon.svg\";\r\nimport unifyTangentIcon from \"./assets/unifyTangentIcon.svg\";\r\nimport stepTangentIcon from \"./assets/stepTangentIcon.svg\";\r\n\r\ninterface ITopBarComponentProps {\r\n    globalState: GlobalState;\r\n    context: Context;\r\n}\r\n\r\ninterface ITopBarComponentState {\r\n    keyFrameValue: string;\r\n    keyValue: string;\r\n    frameControlEnabled: boolean;\r\n    valueControlEnabled: boolean;\r\n}\r\n\r\nexport class TopBarComponent extends React.Component<ITopBarComponentProps, ITopBarComponentState> {\r\n    private _onFrameSetObserver: Nullable<Observer<number>>;\r\n    private _onValueSetObserver: Nullable<Observer<number>>;\r\n    private _onActiveAnimationChangedObserver: Nullable<Observer<IActiveAnimationChangedOptions>>;\r\n    private _onActiveKeyPointChanged: Nullable<Observer<void>>;\r\n\r\n    constructor(props: ITopBarComponentProps) {\r\n        super(props);\r\n\r\n        this.state = { keyFrameValue: \"\", keyValue: \"\", frameControlEnabled: false, valueControlEnabled: false };\r\n\r\n        this._onFrameSetObserver = this.props.context.onFrameSet.add((newFrameValue) => {\r\n            this.setState({ keyFrameValue: newFrameValue.toFixed(0) });\r\n        });\r\n\r\n        this._onValueSetObserver = this.props.context.onValueSet.add((newValue) => {\r\n            this.setState({ keyValue: newValue.toFixed(2) });\r\n        });\r\n\r\n        this._onActiveAnimationChangedObserver = this.props.context.onActiveAnimationChanged.add(() => {\r\n            this.setState({ keyFrameValue: \"\", keyValue: \"\" });\r\n        });\r\n\r\n        this._onActiveKeyPointChanged = this.props.context.onActiveKeyPointChanged.add(() => {\r\n            const numKeys = this.props.context.activeKeyPoints?.length || 0;\r\n            const numAnims = new Set(this.props.context.activeKeyPoints?.map((keyPointComponent) => keyPointComponent.props.curve.animation.uniqueId)).size;\r\n\r\n            const frameControlEnabled = (numKeys === 1 && numAnims === 1) || (numKeys > 1 && numAnims > 1);\r\n            const valueControlEnabled = numKeys > 0;\r\n\r\n            const hasActiveQuaternionAnimation = this.props.context.hasActiveQuaternionAnimationKeyPoints();\r\n\r\n            this.setState({\r\n                keyFrameValue: \"\",\r\n                keyValue: \"\",\r\n                frameControlEnabled: frameControlEnabled && !hasActiveQuaternionAnimation,\r\n                valueControlEnabled: valueControlEnabled && !hasActiveQuaternionAnimation,\r\n            });\r\n        });\r\n    }\r\n\r\n    override componentWillUnmount() {\r\n        if (this._onFrameSetObserver) {\r\n            this.props.context.onFrameSet.remove(this._onFrameSetObserver);\r\n        }\r\n        if (this._onValueSetObserver) {\r\n            this.props.context.onValueSet.remove(this._onValueSetObserver);\r\n        }\r\n        if (this._onActiveAnimationChangedObserver) {\r\n            this.props.context.onActiveAnimationChanged.remove(this._onActiveAnimationChangedObserver);\r\n        }\r\n        if (this._onActiveKeyPointChanged) {\r\n            this.props.context.onActiveKeyPointChanged.remove(this._onActiveKeyPointChanged);\r\n        }\r\n    }\r\n\r\n    public override render() {\r\n        const hasActiveAnimations = this.props.context.activeAnimations.length > 0;\r\n        return (\r\n            <div id=\"top-bar\">\r\n                <img id=\"top-bar-logo\" src={logoIcon} />\r\n                <div id=\"top-bar-parent-name\">{this.props.context.title}</div>\r\n                <TextInputComponent\r\n                    className={hasActiveAnimations && this.state.frameControlEnabled ? \"\" : \"disabled\"}\r\n                    isNumber={true}\r\n                    value={this.state.keyFrameValue}\r\n                    tooltip=\"Frame\"\r\n                    id=\"key-frame\"\r\n                    onValueAsNumberChanged={(newValue) => {\r\n                        if (newValue !== 0) {\r\n                            this.props.context.onFrameManuallyEntered.notifyObservers(newValue);\r\n                        }\r\n                    }}\r\n                    globalState={this.props.globalState}\r\n                    context={this.props.context}\r\n                    disabled={parseFloat(this.state.keyFrameValue) === 0}\r\n                />\r\n                <TextInputComponent\r\n                    className={hasActiveAnimations && this.state.valueControlEnabled ? \"\" : \"disabled\"}\r\n                    isNumber={true}\r\n                    value={this.state.keyValue}\r\n                    tooltip=\"Value\"\r\n                    id=\"key-value\"\r\n                    onValueAsNumberChanged={(newValue) => this.props.context.onValueManuallyEntered.notifyObservers(newValue)}\r\n                    globalState={this.props.globalState}\r\n                    context={this.props.context}\r\n                />\r\n                <ActionButtonComponent\r\n                    className={hasActiveAnimations ? \"\" : \"disabled\"}\r\n                    tooltip=\"New key\"\r\n                    id=\"new-key\"\r\n                    globalState={this.props.globalState}\r\n                    context={this.props.context}\r\n                    icon={newKeyIcon}\r\n                    onClick={() => this.props.context.onCreateOrUpdateKeyPointRequired.notifyObservers()}\r\n                />\r\n                <ActionButtonComponent\r\n                    tooltip=\"Frame canvas\"\r\n                    id=\"frame-canvas\"\r\n                    globalState={this.props.globalState}\r\n                    context={this.props.context}\r\n                    icon={frameIcon}\r\n                    onClick={() => this.props.context.onFrameRequired.notifyObservers()}\r\n                />\r\n                <ActionButtonComponent\r\n                    className={this.props.context.activeKeyPoints && this.props.context.activeKeyPoints.length > 0 ? \"\" : \"disabled\"}\r\n                    tooltip=\"Flatten tangent\"\r\n                    id=\"flatten-tangent\"\r\n                    globalState={this.props.globalState}\r\n                    context={this.props.context}\r\n                    icon={flatTangentIcon}\r\n                    onClick={() => this.props.context.onFlattenTangentRequired.notifyObservers()}\r\n                />\r\n                <ActionButtonComponent\r\n                    className={this.props.context.activeKeyPoints && this.props.context.activeKeyPoints.length > 0 ? \"\" : \"disabled\"}\r\n                    tooltip=\"Linear tangent\"\r\n                    id=\"linear-tangent\"\r\n                    globalState={this.props.globalState}\r\n                    context={this.props.context}\r\n                    icon={linearTangentIcon}\r\n                    onClick={() => this.props.context.onLinearTangentRequired.notifyObservers()}\r\n                />\r\n                <ActionButtonComponent\r\n                    className={this.props.context.activeKeyPoints && this.props.context.activeKeyPoints.length > 0 ? \"\" : \"disabled\"}\r\n                    tooltip=\"Break tangent\"\r\n                    id=\"break-tangent\"\r\n                    globalState={this.props.globalState}\r\n                    context={this.props.context}\r\n                    icon={breakTangentIcon}\r\n                    onClick={() => this.props.context.onBreakTangentRequired.notifyObservers()}\r\n                />\r\n                <ActionButtonComponent\r\n                    className={this.props.context.activeKeyPoints && this.props.context.activeKeyPoints.length > 0 ? \"\" : \"disabled\"}\r\n                    tooltip=\"Unify tangent\"\r\n                    id=\"unify-tangent\"\r\n                    globalState={this.props.globalState}\r\n                    context={this.props.context}\r\n                    icon={unifyTangentIcon}\r\n                    onClick={() => this.props.context.onUnifyTangentRequired.notifyObservers()}\r\n                />\r\n                <ActionButtonComponent\r\n                    className={this.props.context.activeKeyPoints && this.props.context.activeKeyPoints.length > 0 ? \"\" : \"disabled\"}\r\n                    tooltip=\"Step tangent\"\r\n                    id=\"step-tangent\"\r\n                    globalState={this.props.globalState}\r\n                    context={this.props.context}\r\n                    icon={stepTangentIcon}\r\n                    onClick={() => this.props.context.onStepTangentRequired.notifyObservers()}\r\n                />\r\n            </div>\r\n        );\r\n    }\r\n}\r\n"]}