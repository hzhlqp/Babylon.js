{"version":3,"file":"popupComponent.js","sourceRoot":"","sources":["../../src/components/popupComponent.tsx"],"names":[],"mappings":"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","sourcesContent":["import * as React from \"react\";\r\nimport * as ReactDOM from \"react-dom\";\r\nimport { Inspector } from \"../inspector\";\r\nimport { Logger } from \"core/Misc/logger\";\r\n\r\nexport interface IPopupComponentProps {\r\n    id: string;\r\n    title: string;\r\n    size: { width: number; height: number };\r\n    onOpen?: (window: Window) => void;\r\n    onClose: (window: Window) => void;\r\n    onResize?: (window: Window) => void;\r\n    onKeyUp?: (evt: KeyboardEvent) => void;\r\n    onKeyDown?: (evt: KeyboardEvent) => void;\r\n}\r\n\r\nexport class PopupComponent extends React.Component<IPopupComponentProps, { isComponentMounted: boolean; blockedByBrowser: boolean }> {\r\n    private _container: HTMLDivElement | null;\r\n    private _window: Window | null;\r\n    private _host: HTMLDivElement;\r\n\r\n    constructor(props: IPopupComponentProps) {\r\n        super(props);\r\n\r\n        this._container = document.createElement(\"div\");\r\n        this._container.id = this.props.id;\r\n        this._window;\r\n\r\n        this.state = {\r\n            isComponentMounted: false,\r\n            blockedByBrowser: false,\r\n        };\r\n    }\r\n\r\n    override componentDidMount() {\r\n        this.openPopup();\r\n        this.setState({ isComponentMounted: true });\r\n    }\r\n\r\n    onBeforeUnloadListener = () => {\r\n        if (this._window) {\r\n            this._window.close();\r\n        }\r\n    };\r\n\r\n    openPopup() {\r\n        const { title, size, onClose, onOpen } = this.props;\r\n\r\n        const windowVariableName = `window_${title}`;\r\n\r\n        this._container = Inspector._CreatePopup(title, windowVariableName, size.width, size.height, true);\r\n\r\n        if (this._container) {\r\n            this._host = this._container.ownerDocument!.createElement(\"div\");\r\n\r\n            this._host.id = \"host\";\r\n            this._host.style.width = \"auto\";\r\n            this._container.appendChild(this._host);\r\n        }\r\n\r\n        this._window = (Inspector as any)[windowVariableName];\r\n        window.addEventListener(\"beforeunload\", this.onBeforeUnloadListener);\r\n\r\n        if (this._window) {\r\n            if (onOpen) {\r\n                onOpen(this._window);\r\n            }\r\n            this._window.addEventListener(\"keyup\", (evt) => {\r\n                if (this.props.onKeyUp) {\r\n                    this.props.onKeyUp(evt);\r\n                }\r\n            });\r\n\r\n            this._window.addEventListener(\"keydown\", (evt) => {\r\n                if (this.props.onKeyDown) {\r\n                    this.props.onKeyDown(evt);\r\n                }\r\n            });\r\n\r\n            this._window.addEventListener(\"beforeunload\", () => this._window && onClose(this._window));\r\n            this._window.addEventListener(\"resize\", () => {\r\n                if (this.props.onResize) {\r\n                    this._window && this.props.onResize(this._window);\r\n                }\r\n            });\r\n        } else {\r\n            if (!this._window) {\r\n                this.setState({ blockedByBrowser: true }, () => {\r\n                    if (this.state.blockedByBrowser) {\r\n                        Logger.Warn(\"Popup window couldn't be created\");\r\n                    }\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    override componentWillUnmount() {\r\n        window.removeEventListener(\"beforeunload\", this.onBeforeUnloadListener);\r\n        if (this._window) {\r\n            this._window.close();\r\n        }\r\n    }\r\n\r\n    getWindow() {\r\n        return this._window;\r\n    }\r\n\r\n    override render() {\r\n        if (!this.state.isComponentMounted || this._container === null) {\r\n            return null;\r\n        }\r\n        return ReactDOM.createPortal(this.props.children, this._host);\r\n    }\r\n}\r\n"]}